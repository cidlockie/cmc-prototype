{% extends "layout.html" %}
{% block page_title %}
Money Claims Prototype
{% endblock %}
{% block proposition_header %}
{% set my_account="2" %}
{% include "includes/propositional_navigation.html" %}
{% endblock %}
{% block content %}
<main id="content" role="main">
  {% include "includes/phase_banner_beta.html" %}
  <div class="grid-row">
    <div class="column-two-thirds">
      <a href="#" class="link-back">Back</a>
      <h1 class="heading-large">
        Your repayment plan
      </h1>
      <br>
      <form action="residence" method="post" class="form">
        <div class="form-group">
          <fieldset>
            <legend class="visually-hidden">Followed by equal payments of</legend>
            <label class="form-label-bold" for="instalment-first-payment">
              Regular payments of 
            </label>
            <p class="form-hint">For example, Â£200</p>
            <input class="fee pound" maxlength="8" size="8" type="text" value="{{data['instalment-first-payment']}}" name="instalment-first-payment" id="instalment-first-payment">
          </fieldset>
        </div>
        <div class="heading-small">How often you'll make payments</div>
        <div class="form-group">
          <fieldset>
            <legend class="visually-hidden">How often you'll make payments</legend>
            <div class="multiple-choice">
              <input id="radio-01" type="radio" name="radio-payment-frequency" value="Each week" {{ checked("radio-payment-frequency", "Each week") }}>
              <label for="radio-01" data-target="info-01">Every week</label>
            </div>
            <div class="multiple-choice">
              <input id="radio-02" type="radio" name="radio-payment-frequency" value="Every 2 weeks" {{ checked("radio-payment-frequency", "Every 2 weeks") }}>
              <label for="radio-02" data-target="info-02">Every 2 weeks</label>
            </div>
            <div class="multiple-choice">
              <input id="radio-03" type="radio" name="radio-payment-frequency" value="Every month" {{ checked("radio-payment-frequency", "Each month") }}>
              <label for="radio-03" data-target="info-03">Every month</label>
            </div>
          </fieldset>
        </div>

        <div class="form-group">
          <p><a href="#" class="secondary-button" id="calc">Calculate length of repayment plan</a></p>
        </div>

        <div class="form-group hidden" id="duration-box">
          <p class="heading-small">Length of repayment plan</p>
          <p id="duration">-</p>
        </div>


        <div class="form-group">
          <fieldset>
            <legend class="visually-hidden">When you want them to make the first payment</legend>
            <p class="form-label-bold">When will you make the first payment?</p>
            <div class="form-date">
              <p class="form-hint">For example, {{ now | date('add', 1, 'months') | date('D M YYYY') }}</p>
              <div class="form-group form-group-day">
                <label for="dob-day">Day</label>
                <input class="form-control" id="instalment-day" name="instalment-day" type="number" pattern="[0-9]*" min="0" max="31" value="{{data['instalment-day']}}" >
              </div>
              <div class="form-group form-group-month">
                <label for="dob-month">Month</label>
                <input class="form-control" id="instalment-month" name="instalment-month" type="number" pattern="[0-9]*" min="0" max="12" value="{{data['instalment-month']}}">
              </div>
              <div class="form-group form-group-year">
                <label for="dob-year">Year</label>
                <input class="form-control" id="instalment-year" name="instalment-year" type="number" pattern="[0-9]*" min="0" max="2024" value="{{data['instalment-year']}}">
              </div>
            </div>
          </fieldset>
        </div>

        <div class="form-group">
          <fieldset>
            <legend class="visually-hidden">Explain why you can't pay the full amount now</legend>
            <div id="claim-details">
              <div id="describe-wrapper-claim-details-1" class="form-group">
                <label class="form-label-bold" for="offer">
                  Explain why you can't pay the full amount now
                  <span class="form-hint"><!-- For example you might blar blar blar ... --></span>
                </label>
                <textarea class="form-control"
                id="non-payment-reason"
                rows="3"
                name="non-payment-reason"
                type="text"
                style="width: 90%">{{data['non-payment-reason']}}</textarea>
              </div>
            </div>
          </fieldset>

        </div>
        <div class="form-group">
          <input type="submit" class="button" value="Save and continue"/>
        </div>
      </form>
    </div>
  </div>
</main>

<script>
  $(document).ready(function () {
    $('#calc').click( function() {
      if ( $('#instalment-first-payment').val() && $("input[name=radio-payment-frequency]:checked").length ) {

        var intAmount = 1643;
        var strDuration = '';

        $('#duration-box').removeClass('hidden');
        intRepayment = $('#instalment-first-payment').val();

        intInstalments = Math.ceil( intAmount / intRepayment);

        if ($('#radio-01').prop("checked")) {
          intDaysAway = 7;
        } else if ($('#radio-02').prop("checked")) {
          intDaysAway = 14;
        } else if ($('#radio-03').prop("checked")) {
          intDaysAway = 30;
        }

        intRepaymentDays = intDaysAway * intInstalments;
        objDatePaid = moment().add(intRepaymentDays, 'days')
        intYears = objDatePaid.diff( moment(), 'years' );

        if (intYears > 0 ) {
          strDuration = intYears + ' year';
          if (intYears > 1 ) {
            strDuration += 's';
          }
          strDuration += ' ';
          objDatePaid.subtract(intYears, 'years');
        }
        intMonths = objDatePaid.diff( moment(), 'months' );

        if (intMonths) {
          strDuration =  strDuration + intMonths + ' month';
          if (intMonths > 1 ) {
            strDuration += 's';
          }
        }
      $('#duration').text( strDuration );
  
       return false;

      }
    })
  });
</script>

{% endblock %}
